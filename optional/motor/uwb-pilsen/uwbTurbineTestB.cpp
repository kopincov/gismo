/** @file uwbbl ades.cpp

    Author(s): B. Bastl, K. Michalkova
*/

#include <iostream>
#include <gismo.h>
#include <math.h>

//#include "../jku/gsMotorUtils.h"
#include "uwbTurbineUtils.h"
#include "uwbBladeProfile.h"
#include "uwbDraftTube.h"
#include "uwbProfileOptimization.h"
#include "uwbHydraulicProfile.h"
#include "uwbKaplanTurbineRunnerBlade.h"
#include "uwbKaplanTurbineRunnerWheelDomain.h"
#include "uwbKaplanTurbineGuideVane.h"
#include <gsIO/gsIOUtils.h>
//#include <gsOptimizer/gsQualityMeasure.h>

using namespace gismo;


int main(int argc, char *argv[])
{
    bool plot = true; // If set to true, paraview file is generated and launched on exit
    bool print_info = true; // If set to true, some debug informations will be generated to console
    bool simplified_HP = true;
    //bool outFile =false;

    int num_sample_pars = 30;

    std::string outFile;
    if (simplified_HP)
    {
        outFile = "HPgeometry_simplified";
    }
    else
    {
        outFile = "HPgeometry";
    }


    //gsCmdLine cmd("");
    //cmd.addSwitch("plot", "Plot result in ParaView format", plot);

    //try { cmd.getValues(argc,argv); } catch (int rv) { return rv; }


    // READING THE PARAMETERS FOR HYDRAULIC PROFILE DEFINITION FROM THE FILE
    std::string inputFile = MOTOR_DATA_DIR "uwb-pilsen/Parameters_HydraulicProfile.txt";

    std::map <std::string, real_t> param_list;

    std::ifstream cFile;
    cFile.open(inputFile.c_str());
        if (cFile.is_open())
        {
            std::string line;
            while(getline(cFile, line)){
                line.erase(remove_if(line.begin(), line.end(), isspace),
                                     line.end());
                if(line[0] == '#' || line.empty())
                    continue;
                char delimiterPos = line.find("=");
                std::string name = line.substr(0, delimiterPos);
                std::string value_read = line.substr(delimiterPos + 1);
                real_t value;
                if (value_read[0]=='-'){
                    std::string value_read_num = value_read.substr(1);
                value = - atof(value_read_num.c_str());}
                else {value = atof(value_read.c_str());}
                //value = atof(value_read.c_str());
                param_list[name] = value;
            }
            cFile.close();
        }
        else
           { gsWarn << "Unable to open param file." << '\n'; }

    // SETTING PARAMETERS FOR INNER AND OUTER SURFACE OF KAPLAN TURBINE
    // matrix with parameters has the following structure
    // first line: start_x, start_y, 0.0, 0.0
    // line : length, height_start, height_end, 1.0
    // circular arc: centreX, centreY, alpha, 2.0   ...//radius is computed from the previous section
    gsMatrix<real_t> param_inner(12,4);
    param_inner << -1.2, param_list["v1"], 0.0, 0.0,
            param_list["l1"], param_list["v1"], param_list["v1"], 1.0,
            param_list["d1"] - param_list["l1"], param_list["v1"], param_list["v1"], 1.0,
            param_list["d2"], param_list["v1"], param_list["v2"], 1.0,
            param_list["Sx"],0.0,  param_list["alfa02"],2.0,
            param_list["d3"],0.0,param_list["v3"],1.0,
            param_list["d4"],param_list["v3"],param_list["v3"],1.0,
            0.0, 0.0, param_list["alfa031"], 2.0,
            0.0, 0.0, param_list["alfa032"], 2.0,
            param_list["Sx6"],  param_list["Sy6"], param_list["alfa6"], 2.0,
            param_list["d6"], 0.0, param_list["v6"], 1.0,
            param_list["Sx7"], param_list["Sy7"], param_list["alfa7"], 2.0;

    gsMatrix<real_t> param_outer(10,4);
    param_outer << - 1.2, param_list["h1"], 0.0, 0.0,
            param_list["l1"], param_list["h1"], param_list["h1"], 1.0,
            0.75*param_list["l2"], param_list["h1"], 0.25*param_list["h1"]+0.75*param_list["h2"], 1.0,
            0.25*param_list["l2"], 0.75*param_list["h2"], param_list["h2"], 1.0,
            param_list["Sx"],0.0, param_list["alfa"],2.0,
            param_list["Sx2"],param_list["Sy2"], param_list["alfa2"],2.0,
            param_list["l3"], param_list["h3"], param_list["h3"],1.0,
            0.0,0.0, param_list["alfa3"],2.0,
            param_list["Sx4"],param_list["Sy4"],  param_list["alfa4"],2.0,
            param_list["Sx5"],param_list["Sy5"],  param_list["alfa5"],2.0;

    // DEFINITION AND COMPUTATION OF HYDRAULIC PROFILE OF KAPLAN TURBINE
    HydraulicProfile<real_t> mHydraulicProfile(param_inner, param_outer, simplified_HP);
    mHydraulicProfile.computeHydraulicProfile();

    gsVector<real_t> rotation_axis(3);
    rotation_axis << 0, 1, 0;
    gsTensorBSpline<2, real_t> surfaceInner;
    gsTensorBSpline<2, real_t> surfaceInner_rotated;
    surfaceInner = mHydraulicProfile.getHydraulicProfileInner();
    surfaceInner_rotated = surfaceInner;
    surfaceInner_rotated.rotate(PI/2, rotation_axis);

    gsTensorBSpline<2, real_t> surfaceOuter;
    gsTensorBSpline<2, real_t> surfaceOuter_rotated;
    surfaceOuter = mHydraulicProfile.getHydraulicProfileOuter();
    surfaceOuter_rotated = surfaceOuter;
    surfaceOuter_rotated.rotate(PI/2, rotation_axis);
    gsInfo << "HydraulicProfileComputed \n";

    if (plot)
    {
        std::vector<gsGeometry<>*> surfaces_plot;
        surfaces_plot.clear();
        surfaces_plot.push_back(&surfaceInner_rotated);
        surfaces_plot.push_back(&surfaceOuter_rotated);

        gsWriteParaview( surfaces_plot, outFile, 5000);
    }



    int num_bladeprofiles = 7;

    gsVector<> camber_x(num_bladeprofiles);
    gsVector<> camber_y(num_bladeprofiles);
    gsVector<> leading_angle(num_bladeprofiles);
    gsVector<> trailing_angle(num_bladeprofiles);
    gsVector<> thickness_x(num_bladeprofiles);
    gsVector<> thickness_y(num_bladeprofiles);
    gsVector<> ending_offset(num_bladeprofiles);
    gsVector<> output_angle(num_bladeprofiles);
    gsVector<> radius(num_bladeprofiles);
    gsVector<> chord_length(num_bladeprofiles);
    gsVector<> angle(num_bladeprofiles);
    gsVector<> rotation_center_x(num_bladeprofiles);
    gsVector<> rotation_center_y(num_bladeprofiles);
    gsVector<> rr(num_bladeprofiles);

    // SETTING PARAMETERS FOR RUNNER WHEEL BLADE OF KAPLAN TURBINE
    rr << 0.175, 0.229, 0.283, 0.338, 0.392, 0.446, 0.5;
    /* initial parameters */
    camber_x << 0.425908805, 0.419, 0.416039882, 0.416576484, 0.416716376, 0.419203131, 0.43280567; // 0.411886743 na originalne druhe pozici
    camber_y << 0.095896144, 0.064997436, 0.037083707, 0.02724709, 0.024356984, 0.023262639, 0.019802704;
    leading_angle << 38.47692, 21.399859, 12.641776, 9.28275, 8.38282, 8.338553, 8.446091;
    leading_angle = leading_angle*PI/180;
    trailing_angle << 20.717182, 10.721469, 6.371868, 4.702573, 4.217487, 4.164196, 4.233241;
    trailing_angle = trailing_angle*pi/180;
    thickness_x << 0.281408739, 0.275195139, 0.273161229, 0.272459059, 0.272310247, 0.272053329, 0.271637628;
    thickness_y << 0.064950942, 0.044591162, 0.030435219, 0.020799775, 0.01464564, 0.011033004, 0.009989223;
    //ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 8.381088, 5.891258, 4.042351, 2.765094, 1.950139, 1.466739, 1.329705;
    output_angle = output_angle*PI/180;
    radius << 0.020637, 0.014575, 0.007271, 0.003687, 0.001955, 0.001012, 0.000828;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;
    /*             */

    /* optimized parameters  - weights 45-10-45 - Jirka */
    /*camber_x << 0.438934, 0.484151, 0.517409, 0.532565, 0.441976, 0.565015, 0.586543;
    camber_y << 0.098765, 0.0615746, 0.0466702, 0.0376636, 0.0338603, 0.0323390, 0.0275294;
    leading_angle << 0.644522, 0.377191, 0.231429, 0.171243, 0.190951, 0.173210, 0.202166;
    trailing_angle << 0.372363, 0.234235, 0.141542, 0.114099, 0.101884, 0.0987112, 0.102696;
    thickness_x << 0.262784, 0.271642, 0.270569, 0.25, 0.252904, 0.281278, 0.277735;
    thickness_y << 0.0695271, 0.0478379, 0.0348932, 0.0289160, 0.0185910, 0.0105583, 0.0138680;
    ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 0.129297, 0.114074, 0.0709187, 0.0566179, 0.0335955,  0.0307263, 0.0276902;
    radius << 0.0192653, 0.0129705, 0.00873887,  0.00478942, 0.00256835, 0.00110127, 0.000601756;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*                      */

    /* optimized parameters  - weights 75-0-25 - Jirka */
    /*camber_x << 0.52653, 0.554715, 0.545383, 0.542794, 0.541312, 0.548391, 0.564571;
    camber_y << 0.115678, 0.0717365, 0.0490699, 0.0360749, 0.0322462, 0.0305989, 0.0262188;
    leading_angle << 0.643723, 0.38344, 0.175621, 0.140137, 0.152941, 0.174789, 0.191942;
    trailing_angle << 0.447007, 0.247754, 0.14724, 0.108669, 0.0961928, 0.0920507, 0.0834417;
    thickness_x << 0.274731, 0.2534, 0.270057, 0.271837, 0.269468, 0.279987, 0.274258;
    thickness_y << 0.0654609, 0.0485451, 0.0402963, 0.0275377, 0.0193323, 0.0137131, 0.0129307;
    ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 0.154799, 0.122191, 0.0715965, 0.0507242, 0.0375865, 0.0241382, 0.0202734;
    radius << 0.022564, 0.0165906, 0.00768848, 0.00460815, 0.00234054, 0.00104172, 0.000885032;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*                      */

    /* optimized parameters  - weights 34-32-34 ... optimized_blade_weights_34_32_34.curve*/
    /*camber_x << 0.42648, 0.450788, 0.507621, 0.503677, 0.486303, 0.553921, 0.678522;
    camber_y << 0.0829164, 0.0530367, 0.0461242, 0.0357105, 0.0387506, 0.0429777, 0.0298333;
    leading_angle << 0.704351, 0.389298, 0.266307, 0.197238, 0.259981, 0.223525, 0.231495;
    trailing_angle << 0.355646, 0.249175, 0.133658, 0.142542, 0.136606, 0.133029, 0.0850968;
    thickness_x << 0.267145, 0.278283, 0.284118, 0.268236, 0.25, 0.25, 0.266451;
    thickness_y << 0.0533306, 0.0339907, 0.0303265, 0.0210777, 0.0189568, 0.0143208, 0.0149551;
    ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 0.122231, 0.07029, 0.0645483, 0.0567081, 0.0299507, 0.0467854, 0.0266916;
    radius << 0.0221943, 0.0141616, 0.00827746, 0.00452783, 0.00288267, 0.00112878, 0.000688452;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*                      */

    /* optimized parameters  - weights 34-32-34 - korekce parametru prolozenim kubickou krivkou ... optimized_blade_weights_34_32_34_corr.curve */
    /*camber_x << 0.41759, 0.476482, 0.491216, 0.490162, 0.501693, 0.554179, 0.675991;
    camber_y << 0.0828974, 0.0544468, 0.0418388, 0.0391317, 0.0403837, 0.039653, 0.030998;
    leading_angle << 0.7005, 0.399933, 0.254653, 0.214532, 0.229445, 0.249265, 0.223867;
    trailing_angle << 0.36327, 0.224667, 0.158105, 0.137357, 0.136199, 0.128405, 0.0877496;
    thickness_x << 0.265538, 0.28323, 0.280178, 0.266667, 0.252983, 0.249408, 0.266229;
    thickness_y << 0.0522031, 0.0373311, 0.027506, 0.0215051, 0.0181058, 0.0160855, 0.0142216;
    ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 0.119238, 0.079663, 0.0581448, 0.0484444, 0.0443221, 0.0395385, 0.027854;
    radius << 0.0222302, 0.014037, 0.00836554, 0.00470292, 0.00253605, 0.00135191, 0.000637455;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*                      */

    /* optimized parameters  - weights 34-32-34 - korekce parametru prolozenim parabolou ... optimized_blade_weights_34_32_34_corr2.curve */
    /*camber_x << 0.445961, 0.448111, 0.462844, 0.490162, 0.530064, 0.58255, 0.64762;
    camber_y << 0.0769556, 0.0603885, 0.0477806, 0.0391317, 0.0344419, 0.0337113, 0.0369397;
    leading_angle << 0.650373, 0.450059, 0.304779, 0.214532, 0.179319, 0.199139, 0.273993;
    trailing_angle << 0.337044, 0.250893, 0.18433, 0.137357, 0.109974, 0.10218, 0.113975;
    thickness_x << 0.275823, 0.272945, 0.269893, 0.266667, 0.263267, 0.259693, 0.255944;
    thickness_y << 0.0509805, 0.0385537, 0.0287286, 0.0215051, 0.0168832, 0.0148629, 0.0154442;
    //ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    ending_offset << 0.0017, 0.0013, 0.001, 0.000750, 0.000650, 0.000550, 0.0005;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 0.112999, 0.0859025, 0.0643843, 0.0484444, 0.0380826, 0.0332989, 0.0340935;
    radius << 0.0217172, 0.01455, 0.00887858, 0.00470292, 0.00202301, 0.000838872, 0.0011505;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*                      */

    /* optimized parameters  - weights 34-32-34 - korekce tloustky ... optimized_blade_weights_34_32_34_corr3_thickness.curve */
    /*camber_x << 0.42648, 0.450788, 0.507621, 0.503677, 0.486303, 0.553921, 0.582569;
    camber_y << 0.0829164, 0.0530367, 0.0461242, 0.0357105, 0.0387506, 0.0429777, 0.0271787;
    leading_angle << 0.704351, 0.389298, 0.266307, 0.197238, 0.259981, 0.223525, 0.198294;
    trailing_angle << 0.355646, 0.249175, 0.133658, 0.142542, 0.136606, 0.133029, 0.0998794;
    thickness_x << 0.267145, 0.278283, 0.284118, 0.268236, 0.25, 0.25, 0.250045;
    thickness_y << 0.0533306, 0.0339907, 0.0303265, 0.0210777, 0.0189568, 0.0143208, 0.0136436;
    ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 0.122231, 0.07029, 0.0645483, 0.0567081, 0.0299507, 0.0467854, 0.0227521;
    radius << 0.0221943, 0.0141616, 0.00827746, 0.00452783, 0.00288267, 0.00112878, 0.000605112;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*                      */

    /* optimized parameters  - weights 34-32-34 - korekce parabolou, korekce tloustky ... optimized_blade_weights_34_32_34_corr3_thickness2.curve */
    /*camber_x << 0.434538, 0.454964, 0.476552, 0.499301, 0.52321, 0.548281, 0.574513;
    camber_y << 0.0766396, 0.0605782, 0.0481598, 0.0393845, 0.0342523, 0.0327632, 0.0349172;
    leading_angle << 0.646421, 0.452431, 0.309522, 0.217694, 0.176947, 0.187282, 0.248697;
    trailing_angle << 0.338804, 0.249837, 0.182219, 0.135949, 0.11103, 0.107459, 0.125238;
    thickness_x << 0.27387, 0.274117, 0.272237, 0.26823, 0.262095, 0.253834, 0.243444;
    thickness_y << 0.0508244, 0.0386474, 0.028916, 0.02163, 0.0167895, 0.0143945, 0.014445;
    //ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    ending_offset << 0.0017, 0.0013, 0.001, 0.000750, 0.000650, 0.000550, 0.0005;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 0.11253, 0.0861839, 0.0649471, 0.0488196, 0.0378012, 0.031892, 0.031092;
    radius << 0.0217073, 0.014556, 0.00889049, 0.00471085, 0.00201706, 0.000809108, 0.001087;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*                      */

    /* optimized parameters  - weights 75-0-25 */
    /*camber_x << 0.583644, 0.621566, 0.66706, 0.672447, 0.563738, 0.556452, 0.722684;
    camber_y << 0.109051, 0.0688936, 0.0416598, 0.0349996, 0.0365777, 0.0429601, 0.0373031;
    leading_angle << 0.582732, 0.280037, 0.230278, 0.135807, 0.171084, 0.197691, 0.267838;
    trailing_angle << 0.488306, 0.283772, 0.204411, 0.154503, 0.138642, 0.133663, 0.13475;
    thickness_x << 0.313929, 0.253305, 0.271087, 0.253056, 0.255565, 0.267678, 0.25;
    thickness_y << 0.0672701, 0.0496165, 0.0360498, 0.0307361, 0.0273109, 0.0203062, 0.0182275;
    ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 0.14875, 0.106517, 0.0850374, 0.0745657, 0.0557559, 0.0444302, 0.0333314;
    radius << 0.0268792, 0.0106705, 0.00998806, 0.00455967, 0.00222846, 0.00153272, 0.000640698;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*                      */

    /* optimized parameters  - weights 75-0-25 - korekce parametru prolozenim kubickou krivkou */
    /*camber_x << 0.564781, 0.664933, 0.666151, 0.619682, 0.576771, 0.588665, 0.706609;
    camber_y << 0.110269, 0.0657172, 0.0432439, 0.0360607, 0.037379, 0.0404099, 0.0383649;
    leading_angle << 0.56973, 0.321072, 0.189854, 0.147184, 0.16417, 0.211918, 0.261538;
    trailing_angle << 0.482911, 0.298679, 0.195294, 0.149811, 0.139283, 0.140763, 0.131306;
    thickness_x << 0.309509, 0.268665, 0.254164, 0.255543, 0.262337, 0.264083, 0.250319;
    thickness_y << 0.0672715, 0.0491336, 0.0373854, 0.0301948, 0.0257294, 0.022157, 0.0176455;
    ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 0.147185, 0.110026, 0.0854022, 0.0693047, 0.0577254, 0.0466558, 0.0320877;
    radius << 0.0257748, 0.0139967, 0.0073016, 0.0041327, 0.00293311, 0.00214599, 0.000214479;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*                      */

    /* optimized parameters  - weights 75-0-25 - korekce parametru - vybrane parametry z predchozich kroku optimalizace */
    /*camber_x << 0.583644, 0.59766, 0.591976, 0.577382, 0.563738, 0.556452, 0.67812;
    camber_y << 0.109051, 0.0717642, 0.0464607, 0.042515, 0.0365777, 0.0429601, 0.0321578;
    leading_angle << 0.582732, 0.283282, 0.212241, 0.139617, 0.171084, 0.197691, 0.230895;
    trailing_angle << 0.488306, 0.273153, 0.178108, 0.130669, 0.138642, 0.133663, 0.116164;
    thickness_x << 0.305453, 0.288792, 0.27422, 0.263907, 0.260024, 0.264741, 0.280228;
    thickness_y << 0.0672701, 0.0507216, 0.0373468, 0.0311271, 0.0273109, 0.0203062, 0.0157134;
    ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 0.14875, 0.107581, 0.0805848, 0.0732045, 0.0557559, 0.0444302, 0.028734;
    radius << 0.0268792, 0.0108893, 0.0115471, 0.0049624, 0.00222846, 0.00153272, 0.000651507;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*                      */

    /* optimized parameters  - weights 50-0-50 ... optimized_blade_weights_50_0_50.curve*/
    /*camber_x << 0.561007, 0.563927, 0.533805, 0.569773, 0.515903, 0.498946, 0.690634;
    camber_y << 0.105221, 0.0662088, 0.04404, 0.0365536, 0.0381273, 0.0392143, 0.0373032;
    leading_angle << 0.659097, 0.379534, 0.255159, 0.178788, 0.173508, 0.264694, 0.237685;
    trailing_angle << 0.508838, 0.284015, 0.209486, 0.154609, 0.136316, 0.13617, 0.135389;
    thickness_x << 0.28619, 0.25, 0.25, 0.257493, 0.357012, 0.256923, 0.25;
    thickness_y << 0.0610618, 0.0467168, 0.0395165, 0.0292925, 0.0188575, 0.0133, 0.0169488;
    ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 0.153601, 0.125438, 0.107202, 0.07517, 0.0241817, 0.0279052, 0.023148;
    radius << 0.0225194, 0.0164707, 0.00807684, 0.00437105, 0.00342971, 0.0012882, 0.0004256098;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*                      */

    /* optimized parameters  - weights 50-0-50 - korekce parametru prolozenim kubickou krivkou ... optimized_blade_weights_50_0_50_corr.curve*/
    /*camber_x << 0.550162, 0.580202, 0.559167, 0.522476, 0.505546, 0.543796, 0.672645;
    camber_y << 0.105507, 0.0653786, 0.0445372, 0.0371476, 0.0373748, 0.0393838, 0.0373393;
    leading_angle << 0.661004, 0.381977, 0.237037, 0.188697, 0.19947, 0.23187, 0.248409;
    trailing_angle << 0.501682, 0.304512, 0.195423, 0.149008, 0.139863, 0.14258, 0.131755;
    thickness_x << 0.286099, 0.246618, 0.253131, 0.280615, 0.30405, 0.298415, 0.23869;
    thickness_y << 0.059954, 0.0496047, 0.0382621, 0.0275867, 0.0192389, 0.0148793, 0.0161682;
    ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 0.151285, 0.132831, 0.102176, 0.0676678, 0.037658, 0.0204962, 0.0245324;
    radius << 0.0230467, 0.014941, 0.00908329, 0.00509635, 0.00260277, 0.00122518, 0.000586242;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*                      */

    /* optimized parameters  - weights 50-0-50 - korekce parametru - vybrane parametry z predchozich kroku optimalizace ... optimized_blade_weights_50_0_50_corr2.curve*/
    /*camber_x << 0.561007, 0.558598, 0.533805, 0.569773, 0.543579, 0.615161, 0.690634;
    camber_y << 0.105221, 0.067767, 0.04404, 0.0365536, 0.0385845, 0.0370359, 0.0373032;
    leading_angle << 0.659097, 0.364937, 0.255159, 0.178788, 0.165246, 0.222263, 0.237685;
    trailing_angle << 0.508838, 0.273091, 0.209486, 0.154609, 0.117513, 0.115531, 0.135389;
    thickness_x << 0.28619, 0.250836, 0.25, 0.257493, 0.307769, 0.307343, 0.25;
    thickness_y << 0.0610618, 0.0463319, 0.0395165, 0.0292925, 0.0198117, 0.0165355, 0.0169488;
    ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 0.153601, 0.120613, 0.107202, 0.07517, 0.027895, 0.0286501, 0.023148;
    radius << 0.0225194, 0.017157, 0.00807684, 0.00437105, 0.00317428, 0.00109028, 0.000425609;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*                      */

    /* optimized parameters  - weights 50-0-50 - korekce parametru - upravene pro mensi tloustku u vnejsiho plaste ... optimized_blade_weights_50_0_50_corr3_thickness.curve*/
    /*camber_x << 0.561007, 0.558598, 0.533805, 0.569773, 0.543579, 0.566242, 0.582383;
    camber_y << 0.105221, 0.067767, 0.04404, 0.0365536, 0.0385845, 0.0319275, 0.0266465;
    leading_angle << 0.659097, 0.364937, 0.255159, 0.178788, 0.165246, 0.196674, 0.169182;
    trailing_angle << 0.508838, 0.273091, 0.209486, 0.154609, 0.117513, 0.0995956, 0.0994183;
    thickness_x << 0.28619, 0.250836, 0.25, 0.257493, 0.307769, 0.365884, 0.29;
    thickness_y << 0.0610618, 0.0463319, 0.0395165, 0.0292925, 0.0198117, 0.0150677, 0.0115213;
    ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 0.153601, 0.120613, 0.107202, 0.07517, 0.027895, 0.0339828, 0.0226136;
    radius << 0.0225194, 0.017157, 0.00807684, 0.00437105, 0.00317428, 0.00129795, 0.000624893;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*                      */

    /* optimized parameters  - weights 50-0-50 - korekce parametru - upravene pro mensi tloustku u vnejsiho plaste - mirne vyhlazeni ... optimized_blade_weights_50_0_50_corr3_thickness.curve*/
    /*camber_x << 0.56137, 0.55363, 0.549469, 0.549545, 0.55452, 0.565052, 0.581801;
    camber_y << 0.105221, 0.067767, 0.04404, 0.0365536, 0.0385845, 0.0319275, 0.0266465;
    leading_angle << 0.659097, 0.364937, 0.255159, 0.178788, 0.165246, 0.196674, 0.169182;
    trailing_angle << 0.508838, 0.273091, 0.209486, 0.154609, 0.117513, 0.0995956, 0.0994183;
    thickness_x << 0.26539, 0.265503, 0.269847, 0.278421, 0.291225, 0.30826, 0.329525;
    thickness_y << 0.0610618, 0.0463319, 0.0395165, 0.0292925, 0.0198117, 0.0150677, 0.0115213;
    ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 0.153601, 0.120613, 0.107202, 0.07517, 0.027895, 0.0339828, 0.0226136;
    radius << 0.0225194, 0.017157, 0.00807684, 0.00437105, 0.00317428, 0.00129795, 0.000624893;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*                      */

    /* optimized parameters  - weights 50-0-50 - korekce parametru - upravene pro mensi tloustku u vnejsiho plaste - vyhlazeni parametru parabolou ... optimized_blade_weights_50_0_50_corr3_thickness2.curve*/
    /*camber_x << 0.562029, 0.55297, 0.548809, 0.549545, 0.55518, 0.565712, 0.581141;
    camber_y << 0.0994149, 0.0724527, 0.051806, 0.0374748, 0.029459, 0.0277587, 0.0323739;
    leading_angle << 0.616188, 0.419596, 0.274553, 0.181058, 0.139111, 0.148713, 0.209863;
    trailing_angle << 0.473391, 0.328023, 0.216985, 0.140276, 0.0978976, 0.0898485, 0.116129;
    thickness_x << 0.26539, 0.265503, 0.269847, 0.278421, 0.291225, 0.30826, 0.329525;
    thickness_y << 0.0605683, 0.0482901, 0.0376253, 0.0285738, 0.0211356, 0.0153109, 0.0110994;
    ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 0.156883, 0.123406, 0.0940978, 0.0689586, 0.0479885, 0.0311875, 0.0185556;
    radius << 0.022974, 0.0154819, 0.00952521, 0.00510383, 0.00221777, 0.000867046, 0.00105165;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*                      */

    /* optimized parameters  - weights 40-20-40 - ... optimized_blade_weights_40_20_40.curve*/
    /*camber_x << 0.436807, 0.520758, 0.479929, 0.594779, 0.558864, 0.50966, 0.729715;
    camber_y << 0.0959601, 0.0573543, 0.0481241, 0.0354763, 0.0337003, 0.0388076, 0.0363164;
    leading_angle << 0.640901, 0.325517, 0.306037, 0.183514, 0.161371, 0.239414, 0.192408;
    trailing_angle << 0.412316, 0.244002, 0.172984, 0.146173, 0.135956, 0.135641, 0.136429;
    thickness_x << 0.262984, 0.277532, 0.296865, 0.319204, 0.270724, 0.265101, 0.28782;
    thickness_y << 0.0682121, 0.0389673, 0.0288555, 0.0206334, 0.0232412, 0.0172815, 0.01436366;
    ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 0.174195, 0.0820808, 0.0772873, 0.0580591, 0.045471, 0.0410049, 0.0299838;
    radius << 0.018695, 0.0124913, 0.00822938, 0.0041502, 0.00266593, 0.00128466, 0.000998263;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*                      */

    /* optimized parameters  - weights 40-20-40 - vyhlazeni parametru parabolou ... optimized_blade_weights_40_20_40_corr.curve*/
    /*camber_x << 0.467054, 0.480397, 0.501767, 0.531163, 0.568586, 0.614035, 0.667511;
    camber_y << 0.090392, 0.0658519, 0.0478357, 0.0363435, 0.0313751, 0.0329307, 0.0410102;
    leading_angle << 0.591696, 0.411477, 0.279598, 0.196058, 0.160858, 0.173998, 0.235478;
    trailing_angle << 0.386854, 0.274887, 0.192257, 0.138966, 0.115014, 0.120399, 0.155124;
    thickness_x << 0.266945, 0.281211, 0.290106, 0.293631, 0.291785, 0.284569, 0.271982;
    thickness_y << 0.0631394, 0.04526, 0.0315248, 0.0219338, 0.0164869, 0.0151841, 0.0180256;
    ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 0.15617, 0.111626, 0.0770909, 0.0525649, 0.038048, 0.0335402, 0.0390414;
    radius << 0.0185438, 0.0127212, 0.00806951, 0.00458879, 0.00227901, 0.00114018, 0.00117229;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*                      */

    /* optimized parameters  - weights 40-20-40 - uprava sesteho profilu... optimized_blade_weights_40_20_40_corr3_thickness.curve*/
    /*camber_x << 0.436807, 0.499774, 0.520277, 0.538931, 0.558864, 0.606738, 0.729715;
    camber_y << 0.0959601, 0.0568095, 0.0454728, 0.0366637, 0.0337003, 0.037773, 0.0363164;
    leading_angle << 0.640901, 0.314756, 0.275915, 0.184709, 0.161371, 0.206392, 0.192408;
    trailing_angle << 0.412316, 0.233224, 0.149124, 0.10695, 0.135956, 0.116932, 0.136429;
    thickness_x << 0.262984, 0.25753, 0.333489, 0.333504, 0.270724, 0.315596, 0.28782;
    thickness_y << 0.0682121, 0.039004, 0.0287801, 0.0255587, 0.0232412, 0.0169778, 0.0143636;
    ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 0.174195, 0.103583, 0.0777718, 0.0599231, 0.045471, 0.0402537, 0.0299838;
    radius << 0.018695, 0.0144235, 0.00895505, 0.00465016, 0.00266593, 0.0011104, 0.000998263;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*                      */

    /* optimized parameters  - weights 40-20-40 - uprava sesteho profilu, korekce parabolou ... optimized_blade_weights_40_20_40_corr3_thickness2.curve*/
    /*camber_x << 0.460827, 0.475069, 0.499776, 0.534945, 0.580579, 0.636675, 0.703235;
    camber_y << 0.0899688, 0.0652977, 0.0472268, 0.0357561, 0.0308856, 0.0326154, 0.0409453;
    leading_angle << 0.587946, 0.402118, 0.266668, 0.181595, 0.1469, 0.162582, 0.228642;
    trailing_angle << 0.386373, 0.261091, 0.170588, 0.114862, 0.0939152, 0.107746, 0.156356;
    thickness_x << 0.257449, 0.285387, 0.303977, 0.313218, 0.313111, 0.303655, 0.284851;
    thickness_y << 0.0670803, 0.0415774, 0.0285161, 0.0235158, 0.022196, 0.0201762, 0.0130756;
    //ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    ending_offset << 0.0017, 0.0013, 0.001, 0.000750, 0.000650, 0.000550, 0.0005;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 0.16376, 0.11814, 0.0823159, 0.0562891, 0.0400593, 0.0336264, 0.0369905;
    radius << 0.0192505, 0.0135002, 0.00882129, 0.00521391, 0.00267803, 0.00121365, 0.000820756;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*                      */

    /* optimized parameters  - weights 20-30-40 - manual ... optimized_blade_weights_20_30_40.curve */
    /*camber_x << 0.425908805, 0.419, 0.416039882, 0.416576484, 0.416716376, 0.419203131, 0.43280567; // 0.411886743 na originalne druhe pozici
    camber_y << 0.095896144, 0.064997436, 0.037083707, 0.02724709, 0.024356984, 0.023262639, 0.019802704;
    camber_x << 0.562029, 0.55297, 0.548809, 0.549545, 0.55518, 0.565712, 0.581141;
    leading_angle << 38.47692, 21.399859, 13.613644, 10.185323, 9.100307, 9.502749, 10.679332;
    leading_angle = leading_angle*PI/180;
    trailing_angle << 20.717182, 10.721469, 5.4, 3.8, 3.5, 3, 2;
    trailing_angle = trailing_angle*pi/180;
    thickness_x << 0.281408739, 0.275195139, 0.273161229, 0.272459059, 0.272310247, 0.272053329, 0.271637628;
    thickness_y << 0.064950942, 0.044591162, 0.030435219, 0.020799775, 0.01464564, 0.011033004, 0.009989223;
    ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 8.381088, 5.891258, 4.042351, 2.765094, 1.950139, 1.466739, 1.329705;
    output_angle = output_angle*PI/180;
    radius << 0.020637, 0.014575, 0.007271, 0.003687, 0.001955, 0.001012, 0.000828;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 32, 26, 23, 21, 18;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*             */

    /* optimized parameters  - weights 20-30-40 - manual ... optimized_blade_weights_20_30_40_CL.curve */
    /*
    //camber_x << 0.425908805, 0.419, 0.416039882, 0.416576484, 0.416716376, 0.419203131, 0.43280567; // 0.411886743 na originalne druhe pozici
    camber_x << 0.434538, 0.454964, 0.476552, 0.499301, 0.52321, 0.548281, 0.574513; // 34_32_34
    //camber_x << 0.460827, 0.475069, 0.499776, 0.534945, 0.580579, 0.636675, 0.703235; //40_20_40
    camber_y << 0.095896144, 0.064997436, 0.037083707, 0.02724709, 0.024356984, 0.023262639, 0.019802704;
    leading_angle << 38.47692, 21.399859, 13.613644, 10.185323, 9.100307, 9.502749, 10.679332;
    leading_angle = leading_angle*PI/180;
    trailing_angle << 20.717182, 10.721469, 5.4, 3.8, 3.5, 3, 2;
    trailing_angle = trailing_angle*pi/180;
    thickness_x << 0.281408739, 0.275195139, 0.273161229, 0.272459059, 0.272310247, 0.272053329, 0.271637628;
    thickness_y << 0.064950942, 0.044591162, 0.030435219, 0.020799775, 0.01464564, 0.011033004, 0.009989223;
    ending_offset << 0.0014, 0.0011, 0.000850, 0.000670, 0.000530, 0.000420, 0.00037;
    //ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 8.381088, 5.891258, 4.042351, 2.765094, 1.950139, 1.466739, 1.329705;
    output_angle = output_angle*PI/180;
    radius << 0.020637, 0.014575, 0.007271, 0.003687, 0.001955, 0.001012, 0.000828;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 32, 26, 23, 21, 18;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*             */

    /* optimized parameters  - weights 50-0-50 - upravena vstupni rychlosti pro optimalizaci ... optimized_blade_weights_50_0_50_chVel.curve*/
    /*camber_x << 0.55144, 0.611431, 0.603026, 0.545486, 0.521021, 0.580027, 0.598536;
    camber_y << 0.102057, 0.0612635, 0.0431851, 0.0335031, 0.0302775, 0.0257187, 0.0212015;
    leading_angle << 0.596797, 0.328512, 0.156157, 0.14324, 0.154838, 0.11168, 0.137402;
    trailing_angle << 0.487959, 0.273064, 0.162285, 0.119769, 0.107415, 0.106058, 0.107703;
    thickness_x << 0.254592, 0.25, 0.261628, 0.25, 0.260309, 0.250349, 0.260429;
    thickness_y << 0.0609661, 0.0470454, 0.0409118, 0.0303523, 0.0197278, 0.0153622, 0.00934496;
    ending_offset << 0.0014, 0.0011, 0.000850, 0.000670, 0.000530, 0.000420, 0.00037;
    //ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 0.145953, 0.108528, 0.101605, 0.0532315, 0.0277537, 0.0310234, 0.0220319;
    radius << 0.015286, 0.0188763, 0.00747699, 0.00524458, 0.00276373, 0.00110016, 0.000848708;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*                      */

    /* optimized parameters  - weights 50-0-50 - upravena vstupni rychlosti pro optimalizaci, vyhlazeni parametru parabolou ... optimized_blade_weights_50_0_50_chVel_corr.curve*/
    /*camber_x << 0.585027, 0.573247, 0.566128, 0.563672, 0.565877, 0.572744, 0.584272;
    camber_y << 0.095893, 0.0686412, 0.0476249, 0.0328441, 0.0242989, 0.0219892, 0.0259151;
    leading_angle << 0.555801, 0.362173, 0.220094, 0.129563, 0.0905816, 0.103149, 0.167265;
    trailing_angle << 0.459388, 0.304154, 0.189162, 0.114411, 0.079901, 0.0856326, 0.131605;
    thickness_x << 0.254073, 0.254123, 0.254394, 0.254887, 0.255601, 0.256536, 0.257692;
    thickness_y << 0.0604808, 0.0490596, 0.0387867, 0.0296621, 0.0216858, 0.0148577, 0.00917784;
    ending_offset << 0.0014, 0.0011, 0.000850, 0.000670, 0.000530, 0.000420, 0.00037;
    //ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 0.148592, 0.11292, 0.082936, 0.0586408, 0.0400343, 0.0271164, 0.0198871;
    radius << 0.0180502, 0.0133407, 0.00932108, 0.00599125, 0.00335126, 0.00140111, 0.000140788;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*                      */

    /* optimized parameters  - weights 34-32-34 - upravena vstupni rychlosti pro optimalizaci ... optimized_blade_weights_34_32_34_chVel.curve*/
    /*camber_x << 0.452098, 0.470503, 0.519852, 0.481727, 0.51801, 0.566437, 0.603371;
    camber_y << 0.099317, 0.0629875, 0.0385579, 0.0316066, 0.0308551, 0.0271549, 0.0217488;
    leading_angle << 0.678167, 0.375207, 0.205337, 0.140557, 0.162274, 0.147548, 0.143177;
    trailing_angle << 0.389698, 0.211506, 0.109392, 0.0839733, 0.106282, 0.105712, 0.107721;
    thickness_x << 0.256257, 0.255463, 0.257506, 0.289498, 0.254224, 0.260717, 0.281335;
    thickness_y << 0.0488492, 0.0377237, 0.0232772, 0.0199543, 0.0210383, 0.0134607, 0.00936874;
    ending_offset << 0.0014, 0.0011, 0.000850, 0.000670, 0.000530, 0.000420, 0.00037;
    //ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 0.145689, 0.133966, 0.055619, 0.0502313, 0.0333968, 0.0265606, 0.0272081;
    radius << 0.0232319, 0.0138226, 0.00576862, 0.00372908, 0.00280931, 0.00132643, 0.000950091;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*                      */

    /* optimized parameters  - weights 34-32-34 - upravena vstupni rychlosti pro optimalizaci, vyhlazeni parametru parabolou ... optimized_blade_weights_34_32_34_chVel_corr.curve*/
    /*camber_x << 0.461115, 0.470011, 0.484546, 0.504721, 0.530535, 0.561989, 0.599081;
    camber_y << 0.0941512, 0.0668949, 0.0460829, 0.0317152, 0.023792, 0.0223131, 0.0272786;
    leading_angle << 0.635305, 0.414849, 0.252527, 0.14834, 0.102288, 0.11437, 0.184587;
    trailing_angle << 0.362357, 0.234943, 0.143342, 0.0875559, 0.0675832, 0.0834243, 0.135079;
    thickness_x << 0.255854, 0.25911, 0.262241, 0.265249, 0.268131, 0.27089, 0.273524;
    thickness_y << 0.0476018, 0.0368965, 0.028056, 0.0210805, 0.0159699, 0.0127241, 0.0113433;
    ending_offset << 0.0014, 0.0011, 0.000850, 0.000670, 0.000530, 0.000420, 0.00037;
    //ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 0.154606, 0.109844, 0.0745231, 0.0486428, 0.0322034, 0.0252047, 0.0276468;
    radius << 0.0223111, 0.0141481, 0.00789605, 0.00355496, 0.00112483, 0.000605642, 0.0019974;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 53.696487,	41.265848, 33.007703, 27.603276, 24.437586, 22.893162, 21.162381;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*                      */

    /* optimized parameters  - weights 20-30-40 - manual, verze 2 ... optimized_blade_weights_20_30_40_ver2.curve */
    /*camber_x << 0.425908805, 0.419, 0.416039882, 0.416576484, 0.416716376, 0.419203131, 0.43280567; // 0.411886743 na originalne druhe pozici
    camber_y << 0.07429, 0.03411, 0.01803, 0.0108, 0.00711, 0.00418, 0.00357;
    leading_angle << 27.8182, 12.9719, 6.87985, 4.12519, 2.71653, 1.59628, 1.36511;
    leading_angle = leading_angle*PI/180;
    trailing_angle << 13.9091, 6.48595, 3.43993, 2.06259, 1.35827, 0.79814, 0.68256;
    trailing_angle = trailing_angle*pi/180;
    thickness_x << 0.281408739, 0.275195139, 0.273161229, 0.272459059, 0.272310247, 0.272053329, 0.271637628;
    thickness_y << 0.064950942, 0.044591162, 0.030435219, 0.020799775, 0.01464564, 0.011033004, 0.009989223;
    ending_offset << 0.001184, 0.000812, 0.000555, 0.000379, 0.000267, 0.000201, 0.000182;
    //ending_offset << 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0;
    output_angle << 8.381088, 5.891258, 4.042351, 2.765094, 1.950139, 1.466739, 1.329705;
    output_angle = output_angle*PI/180;
    radius << 0.020637, 0.014575, 0.007271, 0.003687, 0.001955, 0.001012, 0.000828;
    chord_length << 0.36686418, 0.42813715,	0.486298848, 0.545457321, 0.595371262, 0.615928719, 0.584588959;
    angle << 52.0627, 36.9347, 30.19, 26.1511, 23.7803, 21.0279, 17.1251;
    angle = angle*PI/180;
    rotation_center_x << 0.494758396, 0.469497406, 0.444542963, 0.417724545, 0.390108787, 0.361175154, 0.330805204;
    rotation_center_y << 0.060495569, 0.028225794, 0.00125711, -0.006884641, -0.010228889, -0.010435203, -0.00079539;*/
    /*             */


    // DEFINITION AND COMMPUTATION OF RUNNER WHEEL BLADE OF KAPLAN TURBINE
    KaplanTurbineRunnerBlade<real_t> runnerBlade(num_bladeprofiles, camber_x, camber_y, leading_angle, trailing_angle, thickness_x, thickness_y, ending_offset,
                                         output_angle, radius, chord_length, angle, rotation_center_x, rotation_center_y, rr);
    runnerBlade.compute(plot, print_info);
    runnerBlade.trimming(surfaceInner, plot, print_info);
    //runnerBlade.exportCurveFile("optimized_blade_weights_20_30_40_ver2.curve", plot, print_info);
    //runnerBlade.exportCurveFile("init_bl.curve", plot, print_info);
/*
    gsTensorBSpline<2> blade_pressure_rot1;
    gsTensorBSpline<2> blade_pressure_rot2;
    gsTensorBSpline<2> blade_pressure_rot3;
    gsTensorBSpline<2> blade_suction_rot1;
    gsTensorBSpline<2> blade_suction_rot2;
    gsTensorBSpline<2> blade_suction_rot3;
    gsVector<> turbine_axis(3);
    turbine_axis << 0.0, 0.0, 1.0;

    blade_pressure_rot1 = runnerBlade.getPressureSideSurfaceAfterTrimming();
    blade_pressure_rot1.rotate(PI/2, turbine_axis);
    blade_pressure_rot2 = blade_pressure_rot1;
    blade_pressure_rot2.rotate(PI/2, turbine_axis);
    blade_pressure_rot3 = blade_pressure_rot2;
    blade_pressure_rot3.rotate(PI/2, turbine_axis);
    blade_suction_rot1 = runnerBlade.getSuctionSideSurfaceAfterTrimming();
    blade_suction_rot1.rotate(PI/2, turbine_axis);
    blade_suction_rot2 = blade_pressure_rot1;
    blade_suction_rot2.rotate(PI/2, turbine_axis);
    blade_suction_rot3 = blade_pressure_rot2;
    blade_suction_rot3.rotate(PI/2, turbine_axis);

    if (plot) {

        gsWriteParaview( blade_pressure_rot1, "blade_pressure_side_rot1", 5000);
        gsWriteParaview( blade_pressure_rot2, "blade_pressure_side_rot2", 5000);
        gsWriteParaview( blade_pressure_rot3, "blade_pressure_side_rot3", 5000);
        gsWriteParaview( blade_suction_rot1, "blade_suction_side_rot1", 5000);
        gsWriteParaview( blade_suction_rot2, "blade_suction_side_rot2", 5000);
        gsWriteParaview( blade_suction_rot3, "blade_suction_side_rot3", 5000);
    }
*/

    // DEFINITION AND COMPUTATION OF RUNNER WHEEL DOMAIN (DOMAIN BETWEEN TWO RUNNER WHEEL BLADES) OF KAPLAN TURBINE
    KaplanTurbineRunnerWheelDomain<real_t> runnerWheelDomain(mHydraulicProfile, runnerBlade, 4);
    runnerWheelDomain.compute(plot, false);

    gsMultiPatch<> mp_runnerWheel;
    mp_runnerWheel = runnerWheelDomain.getRunnerDomain();

    gsMultiPatch<> mp_runnerWheel_linear;
    mp_runnerWheel_linear = makeLinear(mp_runnerWheel, 0);

    gsWriteParaview(mp_runnerWheel, "runner_wheel_domain", 50000, true);
    gsWriteParaview(mp_runnerWheel_linear, "runner_wheel_domain_linear", 50000, true);


    // TESTING - FINDING CLOSEST POINT ON BOUNDARY FOR GIVEN INNER POINT
    /*gsInfo << "Number of patches: " << mp_runnerWheel.nPatches() << "\n";
    gsInfo << "Number of boundaries: " << mp_runnerWheel.nBoundary() << "\n";
    gsInfo << "Number of interfaces: " << mp_runnerWheel.nInterfaces() << "\n";
    gsInfo << "Parameter range (u): " << mp_runnerWheel.parameterRange(0) << "\n";
    gsInfo << "Parameter range (v): " << mp_runnerWheel.parameterRange(1) << "\n";
    gsInfo << "Parameter range (w): " << mp_runnerWheel.parameterRange(2) << "\n";
    */

    // For testing purposes ONLY
    gsMatrix<> parameter_points_HRsurface_beginning(2, num_sample_pars);
    gsMatrix<> parameter_points_HRsurface_quarter(2, num_sample_pars);
    gsMatrix<> points_HRsurface_beginning(2, num_sample_pars);
    gsMatrix<> points_HRsurface_quarter(2, num_sample_pars);
    for (int i = 0; i < num_sample_pars; i++) {
        parameter_points_HRsurface_beginning(0,i) = (real_t) i/(num_sample_pars-1);
        parameter_points_HRsurface_beginning(1,i) = 0.0;
        parameter_points_HRsurface_quarter(0,i) = (real_t) i/(num_sample_pars-1);
        parameter_points_HRsurface_quarter(1,i) = 0.25;
    }
    surfaceInner.eval_into(parameter_points_HRsurface_beginning, points_HRsurface_beginning);
    surfaceInner.eval_into(parameter_points_HRsurface_quarter, points_HRsurface_quarter);
    gsWriteParaviewPoints<real_t>( points_HRsurface_beginning, "curve_HRsurface_beginning");
    gsWriteParaviewPoints<real_t>( points_HRsurface_quarter, "curve_HRsurface_quarter");

    gsTensorBSpline<2> cylinder25;
    gsVector<> cylinder_radii = runnerBlade.getCylinderRadius();
    constructCylinderParametrization(-0.5, 0.3, cylinder_radii(2), cylinder25);
    //gsInfo << cylinder25 << "\n";
    gsWriteParaview( cylinder25, "cylinder1", 5000);
    gsMatrix<> points_cylinder_beginning(2, num_sample_pars);
    gsMatrix<> points_cylinder_quarter(2, num_sample_pars);
    cylinder25.eval_into(parameter_points_HRsurface_beginning, points_cylinder_beginning);
    cylinder25.eval_into(parameter_points_HRsurface_quarter, points_cylinder_quarter);
    gsWriteParaviewPoints<real_t>( points_cylinder_beginning, "cylinder_points_beginning");
    gsWriteParaviewPoints<real_t>( points_cylinder_quarter, "cylinder_points_quarter");
    // End of testing section

    //return system("paraview FD_up_surface_parameterdomain.pvd");

    return system("paraview HPgeometry_simplified.pvd");

}
